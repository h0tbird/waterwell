#!/bin/bash

#------------------------------------------------------------------------------
# Parameters:
#------------------------------------------------------------------------------

[[ $1 != 'tx' && $1 != 'rx' ]] && echo "Usage: $0 (tx|rx) [--flash]" && exit 1 || {
  TXRX=$1 && DEVICE="/dev/arduino/uno/${TXRX}" && shift
}

#------------------------------------------------------------------------------
# Build:
#------------------------------------------------------------------------------

arduino-builder \
-fqbn archlinux-arduino:avr:uno \
-hardware /usr/share/arduino/hardware \
-build-path ${PWD}/.build \
-libraries libs \
-tools /usr/bin \
ww${TXRX}/ww${TXRX}.ino

#------------------------------------------------------------------------------
# Flash:
#------------------------------------------------------------------------------

[[ -c ${DEVICE} && $1 == '--flash' ]] && {
  avrdude -V -F \
  -C /etc/avrdude.conf \
  -p atmega328p \
  -P ${DEVICE} \
  -c arduino \
  -b 115200 \
  -U flash:w:${PWD}/.build/ww${TXRX}.ino.hex
}
